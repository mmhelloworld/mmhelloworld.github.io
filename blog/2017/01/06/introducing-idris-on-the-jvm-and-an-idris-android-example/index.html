<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="https://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Introducing Idris on the JVM and an Idris Android example &middot; mmhelloworld
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        mmhelloworld
      </a>
    </div>
    <p class="lead">Marimuthu Blog</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
  

  


  


  

  
    
      <a class="category-link "
          href="/category/frege/">Frege</a>
    
  

  
    
      <a class="category-link "
          href="/category/idris/">Idris</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/java/">Java</a>
    
  

  
    
      <a class="category-link "
          href="/category/jvm/">JVM</a>
    
  

  

  

  
    
  

  
    
  

  


  <!-- Optional additional links to insert in sidebar nav -->
<section>
    <h3>Recent Posts</h3>
    <ul id="recent_posts">
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2024/07/15/idris-jvm-0-7-0-release/">Idris JVM 0.7.0 Release</a>
        </li>
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2021/07/24/idris-2-initial-release-0-dot-2-1-for-the-jvm/">Idris 2 Initial Release 0.2.1 for the JVM</a>
        </li>
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2020/12/30/idris-2-bootstrap-compiler-on-the-jvm-with-a-jvm-backend/">Idris 2 Bootstrap Compiler on the JVM with a JVM backend</a>
        </li>
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2018/02/11/idris-jvm-automated-ffi-with-null-safety/">Idris JVM: Automated FFI with null safety and exception handling</a>
        </li>
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2017/01/10/idris-jvm-guarding-against-java-null-using-maybe-type/">Idris JVM: Guarding against Java null using Maybe type</a>
        </li>
        
    </ul>
</section>
</nav>


  

  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags/">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search/">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p style="font-size: 0.5rem">
  &copy; Marimuthu Madasamy 2024.
  <a href="/LICENSE">BSD 3-Clause License</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Introducing Idris on the JVM and an Idris Android example</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">06 Jan 2017</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        <a href="/category/idris/">
          Idris
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/jvm/">
          JVM
        </a>
      
    
      &bull;

      
      
      

      
        <a href="/category/java/">
          Java
        </a>
      
    
      &bull;

      
      
      

      
        Android
      
    
  </span>
</div>


  <div class="post-body">
    <p><a href="https://github.com/mmhelloworld/idris-jvm">Idris on the JVM!</a> Yes, a dependently typed language on the JVM!
I have been working on a <a href="https://github.com/mmhelloworld/idris-jvm">JVM bytecode backend for Idris</a> for the past few months and
it is now at a point that we can even write Android programs with Idris without having to write a single line of Java.
In this post, we will see how Idris works on the JVM and an example Android program written in Idris.</p>

<h2 id="hello-world">Hello World</h2>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">module</span> <span class="nn">Main</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">printLn</span> <span class="s">"Hello World"</span>
</code></pre></div></div>

<h6 id="compile">Compile:</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>idris <span class="nt">--portable-codegen</span> jvm <span class="nt">-p</span> idrisjvmffi helloworld.idr <span class="nt">-o</span> target
</code></pre></div></div>

<p>Dependencies are provided as Idris packages, not as Java dependencies like jar or class files.
The overall process is that the compiler reads Idris files and converts them into an intermediate JSON representation and
the JVM bytecode generator takes the JSON files and converts them into JVM bytecode class files directly.
It is only when we run a Java class, we have to provide Java dependency jars. The output option <code class="language-plaintext highlighter-rouge">-o</code> represents a directory
where the Java class files will be created.</p>

<h6 id="run">Run:</h6>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>java <span class="nt">-cp</span> target:/path/to/idris-jvm-runtime-1.0-SNAPSHOT.jar main.Main
<span class="s2">"Hello World"</span>

</code></pre></div></div>

<p>And the output folder contains,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>tree target
target
├── Decidable
│   └── Equality.class
├── main
│   └── Main.class
└── Prelude
    ├── Basics.class
    ├── Bool.class
    ├── Chars.class
    ├── Interfaces.class
    ├── Show.class
    └── Strings.class

</code></pre></div></div>

<p>Why do we have all these classes? We only compiled <code class="language-plaintext highlighter-rouge">Main</code> module! This is because Idris performs whole program analysis/compilation
and code generator generates bytecode for all the modules that are relevant for the result produced by the main program.</p>

<h2 id="how-does-idris-jvm-handle-tail-calls">How does Idris JVM handle tail calls?</h2>

<p>Idris JVM eliminates self-recursion with JVM <code class="language-plaintext highlighter-rouge">GOTO</code> and uses trampolines for other tail calls.
Let’s look at the following examples.</p>

<h5 id="self-recursion-example">self-recursion example</h5>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">module</span> <span class="nn">Main</span>

<span class="kr">import</span> <span class="nn">IdrisJvm.IO</span>

<span class="n">sum</span> <span class="o">:</span> <span class="kt">Nat</span> <span class="o">-&gt;</span> <span class="kt">Nat</span>
<span class="n">sum</span> <span class="n">n</span> <span class="o">=</span> <span class="n">go</span> <span class="mi">0</span> <span class="n">n</span> <span class="kr">where</span>
  <span class="n">go</span> <span class="o">:</span> <span class="kt">Nat</span> <span class="o">-&gt;</span> <span class="kt">Nat</span> <span class="o">-&gt;</span> <span class="kt">Nat</span>
  <span class="n">go</span> <span class="n">acc</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">acc</span>
  <span class="n">go</span> <span class="n">acc</span> <span class="n">n</span><span class="o">@</span><span class="p">(</span><span class="kt">S</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">go</span> <span class="p">(</span><span class="n">acc</span> <span class="o">+</span> <span class="n">n</span><span class="p">)</span> <span class="n">k</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">JVM_IO</span> <span class="nb">()</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">printLn</span> <span class="p">(</span><span class="n">sum</span> <span class="mi">50000</span><span class="p">)</span>

</code></pre></div></div>

<p>This program would work just fine without blowing up the stack as it will be compiled down to a loop that uses JVM’s <code class="language-plaintext highlighter-rouge">GOTO</code> instruction.
Here is the relevant section from bytecode:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>javap <span class="nt">-c</span> <span class="nt">-cp</span> target:/path/to/idris-jvm-runtime-1.0-SNAPSHOT.jar main.Main

  public static java.lang.Object <span class="nb">sum</span><span class="nv">$whr$go$colon$0</span><span class="o">(</span>java.lang.Object, java.lang.Object, java.lang.Object<span class="o">)</span><span class="p">;</span>
    Code:
       0: aconst_null
       1: astore        7
       3: aconst_null
       4: astore_3
       5: aconst_null
       6: astore        4
       8: aconst_null
       9: astore        5
      11: aconst_null
      12: astore        6
      14: iconst_1
      15: istore        8
      17: iload         8
      19: ifeq          130
      22: aload_2
      23: new           <span class="c">#80                 // class java/math/BigInteger</span>
      26: dup
      27: ldc           <span class="c">#82                 // String 0</span>
      29: invokespecial <span class="c">#85                 // Method java/math/BigInteger."&lt;init&gt;":(Ljava/lang/String;)V</span>
      32: invokestatic  <span class="c">#333                // Method mmhelloworld/idrisjvmruntime/Util.equals:(Ljava/lang/Object;Ljava/lang/Object;)Z</span>
      35: ifeq          47
      38: aload_1
      39: astore        7
      41: iconst_0
      42: istore        8
      44: goto          127
      47: new           <span class="c">#80                 // class java/math/BigInteger</span>
      50: dup
      51: ldc_w         <span class="c">#335                // String 1</span>
      54: invokespecial <span class="c">#85                 // Method java/math/BigInteger."&lt;init&gt;":(Ljava/lang/String;)V</span>
      57: astore_3
      58: aload_2
      59: invokestatic  <span class="c">#103                // Method mmhelloworld/idrisjvmruntime/Util.asBigInt:(Ljava/lang/Object;)Ljava/math/BigInteger;</span>
      62: aload_3
      63: invokestatic  <span class="c">#103                // Method mmhelloworld/idrisjvmruntime/Util.asBigInt:(Ljava/lang/Object;)Ljava/math/BigInteger;</span>
      66: invokevirtual <span class="c">#338                // Method java/math/BigInteger.subtract:(Ljava/math/BigInteger;)Ljava/math/BigInteger;</span>
      69: astore_3
      70: new           <span class="c">#80                 // class java/math/BigInteger</span>
      73: dup
      74: ldc_w         <span class="c">#335                // String 1</span>
      77: invokespecial <span class="c">#85                 // Method java/math/BigInteger."&lt;init&gt;":(Ljava/lang/String;)V</span>
      80: astore        4
      82: aload_3
      83: invokestatic  <span class="c">#103                // Method mmhelloworld/idrisjvmruntime/Util.asBigInt:(Ljava/lang/Object;)Ljava/math/BigInteger;</span>
      86: aload         4
      88: invokestatic  <span class="c">#103                // Method mmhelloworld/idrisjvmruntime/Util.asBigInt:(Ljava/lang/Object;)Ljava/math/BigInteger;</span>
      91: invokevirtual <span class="c">#107                // Method java/math/BigInteger.add:(Ljava/math/BigInteger;)Ljava/math/BigInteger;</span>
      94: astore        4
      96: iconst_0
      97: invokestatic  <span class="c">#41                 // Method java/lang/Integer.valueOf:(I)Ljava/lang/Integer;</span>
     100: astore        5
     102: aload_1
     103: invokestatic  <span class="c">#103                // Method mmhelloworld/idrisjvmruntime/Util.asBigInt:(Ljava/lang/Object;)Ljava/math/BigInteger;</span>
     106: aload         4
     108: invokestatic  <span class="c">#103                // Method mmhelloworld/idrisjvmruntime/Util.asBigInt:(Ljava/lang/Object;)Ljava/math/BigInteger;</span>
     111: invokevirtual <span class="c">#107                // Method java/math/BigInteger.add:(Ljava/math/BigInteger;)Ljava/math/BigInteger;</span>
     114: astore        6
     116: aload         5
     118: astore_0
     119: aload         6
     121: astore_1
     122: aload_3
     123: astore_2
     124: goto          127
     127: goto          17
     130: aload         7
     132: areturn

</code></pre></div></div>
<p>The third line from the last is the <code class="language-plaintext highlighter-rouge">GOTO</code> instruction that transfers the control back to the top of function instead of
actually calling the function.</p>

<h5 id="mutual-recursion-example">Mutual recursion example:</h5>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">module</span> <span class="nn">Main</span>

<span class="n">mutual</span>
  <span class="n">evenT</span> <span class="o">:</span> <span class="kt">Nat</span> <span class="o">-&gt;</span> <span class="kt">IO</span> <span class="kt">Bool</span>
  <span class="n">evenT</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">pure</span> <span class="kt">True</span>
  <span class="n">evenT</span> <span class="p">(</span><span class="kt">S</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">oddT</span> <span class="n">k</span>

  <span class="n">oddT</span> <span class="o">:</span> <span class="kt">Nat</span> <span class="o">-&gt;</span> <span class="kt">IO</span> <span class="kt">Bool</span>
  <span class="n">oddT</span> <span class="kt">Z</span> <span class="o">=</span> <span class="n">pure</span> <span class="kt">False</span>
  <span class="n">oddT</span> <span class="p">(</span><span class="kt">S</span> <span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">evenT</span> <span class="n">k</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">printLn</span> <span class="o">!</span><span class="p">(</span><span class="n">evenT</span> <span class="mi">9999</span><span class="p">)</span>

</code></pre></div></div>

<p>The above code also would work fine without killing the stack. Mutual recursion is handled using trampolines and
the tail calls are delayed and compiled down to Java 8 lambdas. As the bytecode for this is bit long, here is the
decompiled bytecode for the <code class="language-plaintext highlighter-rouge">evenT</code> function:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="kd">public</span> <span class="kd">static</span> <span class="nc">Object</span> <span class="nf">evenT</span><span class="o">(</span><span class="nc">Object</span> <span class="n">var0</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Object</span> <span class="n">var4</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">Integer</span> <span class="n">var1</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">Integer</span> <span class="n">var2</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">IdrisObject</span> <span class="n">var3</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="k">if</span> <span class="o">(</span><span class="nc">Util</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">var0</span><span class="o">,</span> <span class="nc">BigInteger</span><span class="o">.</span><span class="na">ZERO</span><span class="o">))</span> <span class="o">{</span>
            <span class="n">var1</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">var2</span> <span class="o">=</span> <span class="nc">Integer</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
            <span class="n">var3</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IdrisObject</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
            <span class="n">var4</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">IdrisObject</span><span class="o">(</span><span class="mi">65653</span><span class="o">,</span> <span class="k">new</span> <span class="nc">Object</span><span class="o">[]{</span><span class="n">var1</span><span class="o">,</span> <span class="n">var2</span><span class="o">,</span> <span class="n">var3</span><span class="o">});</span>
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
            <span class="nc">BigInteger</span> <span class="n">var5</span> <span class="o">=</span> <span class="nc">BigInteger</span><span class="o">.</span><span class="na">ONE</span><span class="o">;</span>
            <span class="n">var5</span> <span class="o">=</span> <span class="nc">Util</span><span class="o">.</span><span class="na">asBigInt</span><span class="o">(</span><span class="n">var0</span><span class="o">).</span><span class="na">subtract</span><span class="o">(</span><span class="nc">Util</span><span class="o">.</span><span class="na">asBigInt</span><span class="o">(</span><span class="n">var5</span><span class="o">));</span>
            <span class="n">var4</span> <span class="o">=</span> <span class="o">()</span> <span class="o">-&gt;</span> <span class="o">{</span>
                <span class="k">return</span> <span class="nf">oddT</span><span class="o">(</span><span class="n">var5</span><span class="o">);</span>
            <span class="o">};</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">var4</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div>

<p>As we can see from the decompiled output above, the <code class="language-plaintext highlighter-rouge">oddT</code> call is not performed on the same call stack but a thunk
wrapping the function call is returned using lambda (which is compiled down to JVM’s <code class="language-plaintext highlighter-rouge">invokedynamic</code> instruction).</p>

<p>Here is the relevant bit from bytecode for those who are interested:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>        68: getstatic     #64                 // Field java/math/BigInteger.ONE:Ljava/math/BigInteger;
        71: astore_1
        72: aload_0
        73: invokestatic  #68                 // Method io/github/mmhelloworld/idrisjvm/runtime/Util.asBigInt:(Ljava/lang/Object;)Ljava/math/BigInteger;
        76: aload_1
        77: invokestatic  #68                 // Method io/github/mmhelloworld/idrisjvm/runtime/Util.asBigInt:(Ljava/lang/Object;)Ljava/math/BigInteger;
        80: invokevirtual #72                 // Method java/math/BigInteger.subtract:(Ljava/math/BigInteger;)Ljava/math/BigInteger;
        83: astore_1
        84: aload_1
        85: invokedynamic #79,  0             // InvokeDynamic #1:call:(Ljava/lang/Object;)Lio/github/mmhelloworld/idrisjvm/runtime/Thunk;
        90: astore        4
        92: goto          95
        95: aload         4
        97: areturn
</code></pre></div></div>

<h2 id="java-interoperability-calling-java-from-idris-and-calling-idris-from-java">Java interoperability: Calling Java from Idris and calling Idris from Java</h2>

<p>Idris JVM supports calling Java static methods, instance methods, constructors and also accessing static and instance fields from Idris.
At the moment, except for Java arrays, all the Java types can be constructed from Idris and passed to Java methods.
Support for handling nulls and exceptions is currently in progress and will soon be available.
(Update 01/10/2017: We can now
<a href="http://mmhelloworld.github.io/blog/2017/01/10/idris-jvm-guarding-against-java-null-using-maybe-type/">use <code class="language-plaintext highlighter-rouge">Maybe</code> type to avoid Java nulls</a>
in Idris code)</p>

<p>To use Idris functions from Java, Idris JVM supports exporting Idris functions as static methods, instance methods,
constructors of an exported Java class. The exported class can also extend a Java class or implement interfaces with Idris functions.</p>

<p>To demonstrate these features, let’s create an Android application In Idris.</p>

<h3 id="an-android-application-in-idris">An Android application in Idris</h3>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">module</span> <span class="nn">Main</span>

<span class="kr">import</span> <span class="nn">IdrisJvm.IO</span>
<span class="kr">import</span> <span class="nn">Java.Lang</span>

<span class="n">pythag</span> <span class="o">:</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">List</span> <span class="p">(</span><span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">,</span> <span class="kt">Int</span><span class="p">)</span>
<span class="n">pythag</span> <span class="n">max</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span> <span class="o">|</span> <span class="n">z</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="n">max</span><span class="p">],</span> <span class="n">y</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="n">z</span><span class="p">],</span> <span class="n">x</span> <span class="o">&lt;-</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="n">y</span><span class="p">],</span>
                          <span class="n">x</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">*</span> <span class="n">y</span> <span class="o">==</span> <span class="n">z</span> <span class="o">*</span> <span class="n">z</span><span class="p">]</span>

<span class="kt">IdrisAndroidActivity</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kt">IdrisAndroidActivity</span> <span class="o">=</span> <span class="kt">JVM_Native</span> <span class="o">$</span> <span class="kt">Class</span> <span class="s">"hello/IdrisAndroidActivity"</span>

<span class="kt">Bundle</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kt">Bundle</span> <span class="o">=</span> <span class="kt">JVM_Native</span> <span class="o">$</span> <span class="kt">Class</span> <span class="s">"android/os/Bundle"</span>

<span class="kt">Context</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kt">Context</span> <span class="o">=</span> <span class="kt">JVM_Native</span> <span class="o">$</span> <span class="kt">Class</span> <span class="s">"android/content/Context"</span>

<span class="kt">View</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kt">View</span> <span class="o">=</span> <span class="kt">JVM_Native</span> <span class="o">$</span> <span class="kt">Class</span> <span class="s">"android/view/View"</span>

<span class="kt">TextView</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kt">TextView</span> <span class="o">=</span> <span class="kt">JVM_Native</span> <span class="o">$</span> <span class="kt">Class</span> <span class="s">"android/widget/TextView"</span>

<span class="kt">Inherits</span> <span class="kt">View</span> <span class="kt">TextView</span> <span class="kr">where</span> <span class="p">{}</span>

<span class="kt">CharSequence</span> <span class="o">:</span> <span class="kt">Type</span>
<span class="kt">CharSequence</span> <span class="o">=</span> <span class="kt">JVM_Native</span> <span class="o">$</span> <span class="kt">Class</span> <span class="s">"java/lang/CharSequence"</span>

<span class="kt">Inherits</span> <span class="kt">CharSequence</span> <span class="kt">String</span> <span class="kr">where</span> <span class="p">{}</span>

<span class="n">superOnCreate</span> <span class="o">:</span> <span class="kt">IdrisAndroidActivity</span> <span class="o">-&gt;</span> <span class="kt">Bundle</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="nb">()</span>
<span class="n">superOnCreate</span> <span class="o">=</span> <span class="n">invokeInstance</span> <span class="s">"superOnCreate"</span> <span class="p">(</span><span class="kt">IdrisAndroidActivity</span> <span class="o">-&gt;</span> <span class="kt">Bundle</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="nb">()</span><span class="p">)</span>

<span class="n">getApplicationContext</span> <span class="o">:</span> <span class="kt">IdrisAndroidActivity</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="kt">Context</span>
<span class="n">getApplicationContext</span> <span class="o">=</span> <span class="n">invokeInstance</span> <span class="s">"getApplicationContext"</span> <span class="p">(</span><span class="kt">IdrisAndroidActivity</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="kt">Context</span><span class="p">)</span>

<span class="n">newTextView</span> <span class="o">:</span> <span class="kt">Context</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="kt">TextView</span>
<span class="n">newTextView</span> <span class="o">=</span> <span class="kt">FFI</span><span class="o">.</span><span class="n">new</span> <span class="p">(</span><span class="kt">Context</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="kt">TextView</span><span class="p">)</span>

<span class="n">setText</span> <span class="o">:</span> <span class="kt">Inherits</span> <span class="kt">CharSequence</span> <span class="n">charSequence</span> <span class="o">=&gt;</span> <span class="kt">TextView</span> <span class="o">-&gt;</span> <span class="n">charSequence</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="nb">()</span>
<span class="n">setText</span> <span class="n">this</span> <span class="n">text</span> <span class="o">=</span> <span class="n">invokeInstance</span> <span class="s">"setText"</span> <span class="p">(</span><span class="kt">TextView</span> <span class="o">-&gt;</span> <span class="kt">CharSequence</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="nb">()</span><span class="p">)</span> <span class="n">this</span> <span class="p">(</span><span class="n">believe_me</span> <span class="n">text</span><span class="p">)</span>

<span class="n">setContentView</span> <span class="o">:</span> <span class="kt">Inherits</span> <span class="kt">View</span> <span class="n">view</span> <span class="o">=&gt;</span> <span class="kt">IdrisAndroidActivity</span> <span class="o">-&gt;</span> <span class="n">view</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="nb">()</span>
<span class="n">setContentView</span> <span class="n">this</span> <span class="n">view</span> <span class="o">=</span> <span class="n">invokeInstance</span> <span class="s">"setContentView"</span> <span class="p">(</span><span class="kt">IdrisAndroidActivity</span> <span class="o">-&gt;</span> <span class="kt">View</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="nb">()</span><span class="p">)</span> <span class="n">this</span> <span class="p">(</span><span class="n">believe_me</span> <span class="n">view</span><span class="p">)</span>

<span class="n">onCreate</span> <span class="o">:</span> <span class="kt">IdrisAndroidActivity</span> <span class="o">-&gt;</span> <span class="kt">Bundle</span> <span class="o">-&gt;</span> <span class="kt">JVM_IO</span> <span class="nb">()</span>
<span class="n">onCreate</span> <span class="n">this</span> <span class="n">bundle</span> <span class="o">=</span> <span class="kr">do</span>
  <span class="n">superOnCreate</span> <span class="n">this</span> <span class="n">bundle</span>
  <span class="n">context</span> <span class="o">&lt;-</span> <span class="n">getApplicationContext</span> <span class="n">this</span>
  <span class="n">textView</span> <span class="o">&lt;-</span> <span class="n">newTextView</span> <span class="n">context</span>
  <span class="n">setText</span> <span class="n">textView</span> <span class="o">$</span> <span class="s">"Hello Android from Idris! pythag 50 is "</span> <span class="o">++</span> <span class="n">show</span> <span class="p">(</span><span class="n">pythag</span> <span class="mi">50</span><span class="p">)</span>
  <span class="n">setContentView</span> <span class="n">this</span> <span class="n">textView</span>

<span class="n">main</span> <span class="o">:</span> <span class="kt">IO</span> <span class="nb">()</span>
<span class="n">main</span> <span class="o">=</span> <span class="n">pure</span> <span class="nb">()</span>

<span class="n">androidExport</span><span class="o">:</span> <span class="kt">FFI_Export</span> <span class="kt">FFI_JVM</span> <span class="s">"hello/IdrisAndroidActivity extends android/support/v7/app/AppCompatActivity"</span> <span class="kt">[]</span>
<span class="n">androidExport</span> <span class="o">=</span>
  <span class="kt">Fun</span> <span class="n">superOnCreate</span> <span class="p">(</span><span class="kt">Super</span> <span class="s">"onCreate"</span><span class="p">)</span> <span class="o">$</span>
  <span class="kt">Fun</span> <span class="n">onCreate</span> <span class="p">(</span><span class="kt">ExportInstance</span> <span class="s">"onCreate"</span><span class="p">)</span> <span class="o">$</span>
  <span class="kt">End</span>

</code></pre></div></div>

<p>The above program demonstrates calling Java instance methods (<code class="language-plaintext highlighter-rouge">setText</code> for example) and constructors (<code class="language-plaintext highlighter-rouge">newTextView</code>).</p>

<p>It further demonstrates how to handle inheritance relationship when passing subclass instances to a parent class type.
For example, function <code class="language-plaintext highlighter-rouge">setContentView</code> takes a <code class="language-plaintext highlighter-rouge">View</code> but we can pass a <code class="language-plaintext highlighter-rouge">TextView</code> as it is a subclass of <code class="language-plaintext highlighter-rouge">View</code> and we
mention that to Idris via <code class="language-plaintext highlighter-rouge">Inherits View TextView where {}</code>.</p>

<p>It also demonstrates how we can create a Java class that extends another class and override methods with Idris functions.
The last section <code class="language-plaintext highlighter-rouge">androidExport</code> creates a Java class named <code class="language-plaintext highlighter-rouge">hello/IdrisAndroidActivity</code> that extends <code class="language-plaintext highlighter-rouge">android/support/v7/app/AppCompatActivity</code>.
The Java class also creates a wrapper method <code class="language-plaintext highlighter-rouge">superOnCreate</code> that just delegates to <code class="language-plaintext highlighter-rouge">super.OnCreate</code> and the class also overrides <code class="language-plaintext highlighter-rouge">onCreate</code> method
with Idris’ <code class="language-plaintext highlighter-rouge">onCreate</code> function. The Java class can also implement one or more Java interfaces with something like,</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>hello/IdrisAndroidActivity extends android/support/v7/app/AppCompatActivity implements java/lang/Runnable, java/lang/Comparable
</code></pre></div></div>

<p>A module can have multiple exports so we can actually create multiple Java classes with Idris implementation functions from an Idris module.</p>

<p>We can compile this as usual,</p>

<p><code class="language-plaintext highlighter-rouge">idris --portable-codegen jvm -p idrisjvmffi idrisandroid.idr -o target</code></p>

<p>It would produce the following class files:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ tree target/
target/
├── Decidable
│   └── Equality.class
├── hello
│   └── IdrisAndroidActivity.class
├── main
│   ├── Main.class
│   └── Prelude.class
└── Prelude
    ├── Algebra.class
    ├── Applicative.class
    ├── Bool.class
    ├── Foldable.class
    ├── Interfaces.class
    ├── List.class
    ├── Monad.class
    ├── Show.class
    └── Strings.class

</code></pre></div></div>

<h5 id="deploying-to-android">Deploying to Android:</h5>
<ol>
  <li>Create an android project using Android studio with <a href="https://developer.android.com/guide/platform/j8-jack.html#configuration">Jack support for Java 8</a>.</li>
  <li>Then package the classes compiled above along with idris-jvm-runtime-1.0-SNAPSHOT.jar classes in a single jar and copy into an
android project’s <code class="language-plaintext highlighter-rouge">app/libs</code> directory.</li>
  <li>Change the activity class name in android manifest file to the Idris exported class name <code class="language-plaintext highlighter-rouge">hello.IdrisAndroidActivity</code>.</li>
  <li>Then run <code class="language-plaintext highlighter-rouge">./gradlew installDebug</code> from android project after starting an emulator or connected to an android device.</li>
  <li>Finally we should see our Idris code running on Android! It should look something like this:
<img src="/images/idris-android.png" alt="Idris Android" /></li>
</ol>

<p>Happy coding!</p>

    



<div class="post-tags">
  
    
    <a href="/tags/#idris">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">Idris</span>
    </a>
  
    
    <a href="/tags/#jvm">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">JVM</span>
    </a>
  
    
    <a href="/tags/#java">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">Java</span>
    </a>
  
    
    <a href="/tags/#android">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">Android</span>
    </a>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    
  <div id="disqus_thread">
    <button class="disqus-load" onClick="loadDisqusComments()">
      Load Comments
    </button>
  </div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW
  *  TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:s
  *  https://disqus.com/admin/universalcode/#configuration-variables
  */
  var disqus_config = function () {
    this.page.url = "http://localhost:4000/blog/2017/01/06/introducing-idris-on-the-jvm-and-an-idris-android-example/";
    this.page.identifier = "" ||
                           "http://localhost:4000/blog/2017/01/06/introducing-idris-on-the-jvm-and-an-idris-android-example/";
  }
  function loadDisqusComments() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//mmhelloworld.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  }
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.
  </noscript>



  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/blog/2024/07/15/idris-jvm-0-7-0-release/">
            Idris JVM 0.7.0 Release
            <small>15 Jul 2024</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2021/07/24/idris-2-initial-release-0-dot-2-1-for-the-jvm/">
            Idris 2 Initial Release 0.2.1 for the JVM
            <small>24 Jul 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2020/12/30/idris-2-bootstrap-compiler-on-the-jvm-with-a-jvm-backend/">
            Idris 2 Bootstrap Compiler on the JVM with a JVM backend
            <small>30 Dec 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
