<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="https://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />

  <title>
    
      Haskell on the JVM via GHCJS and Nashorn &middot; mmhelloworld
    
  </title>

  


  <!-- CSS -->
  <link rel="stylesheet" href="/assets/css/main.css" />
  

<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface" />

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/favicon.png" />
<link rel="shortcut icon" href="/favicon.ico" />

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/feed.xml" />

  <!-- Additional head bits without overriding original head -->
</head>


  <body class="post">

    <div id="sidebar">
  <header>
    <div class="site-title">
      <a href="/">
        
          <span class="back-arrow icon"><svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
  <path d="M0 0h24v24H0z" fill="none"/>
  <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
</svg></span>
        
        mmhelloworld
      </a>
    </div>
    <p class="lead">The Joy of Programming!</p>
  </header>
  <nav id="sidebar-nav-links">
  
    <a class="home-link "
        href="/">Home</a>
  
  

  

  


  

  
    
  

  
    
  

  
    
  

  
    
  

  
    
  

  

  

  
    
  

  
    
  

  


  


  

  
    
      <a class="category-link "
          href="/category/frege/">Frege</a>
    
  

  
    
      <a class="category-link "
          href="/category/idris/">Idris</a>
    
  

  
    
  

  
    
      <a class="category-link "
          href="/category/java/">Java</a>
    
  

  
    
      <a class="category-link "
          href="/category/jvm/">JVM</a>
    
  

  

  

  
    
  

  
    
  

  


  <!-- Optional additional links to insert in sidebar nav -->
<section>
    <h3>Recent Posts</h3>
    <ul id="recent_posts">
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2024/07/15/idris-jvm-0-7-0-release/">Idris JVM 0.7.0 Release</a>
        </li>
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2021/07/24/idris-2-initial-release-0-dot-2-1-for-the-jvm/">Idris 2 Initial Release 0.2.1 for the JVM</a>
        </li>
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2020/12/30/idris-2-bootstrap-compiler-on-the-jvm-with-a-jvm-backend/">Idris 2 Bootstrap Compiler on the JVM with a JVM backend</a>
        </li>
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2018/02/11/idris-jvm-automated-ffi-with-null-safety/">Idris JVM: Automated FFI with null safety and exception handling</a>
        </li>
        
        <li class="post">
            <a style="font-size: 0.65rem" href="/blog/2017/01/10/idris-jvm-guarding-against-java-null-using-maybe-type/">Idris JVM: Guarding against Java null using Maybe type</a>
        </li>
        
    </ul>
</section>
</nav>


  

  <nav id="sidebar-icon-links">
  

  <a id="subscribe-link"
     class="icon" title="Subscribe" aria-label="Subscribe"
     href="/feed.xml">
    <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <circle cx="6.18" cy="17.82" r="2.18"/>
    <path d="M4 4.44v2.83c7.03 0 12.73 5.7 12.73 12.73h2.83c0-8.59-6.97-15.56-15.56-15.56zm0 5.66v2.83c3.9 0 7.07 3.17 7.07 7.07h2.83c0-5.47-4.43-9.9-9.9-9.9z"/>
</svg>
  </a>

  
  
  
  

  
    <a id="tags-link"
       class="icon"
       title="Tags" aria-label="Tags"
       href="/tags/">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
    </a>
  

  
    <a id="search-link"
       class="icon"
       title="Search" aria-label="Search"
       href="/search/">
      <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
    <path d="M0 0h24v24H0z" fill="none"/>
</svg>
    </a>
  

  <!-- Optional additional links to insert for icons links -->
</nav>

  <p style="font-size: 0.5rem">
  &copy; Marimuthu Madasamy 2024.
  <a href="/LICENSE">BSD 3-Clause License</a>
</p>

</div>

    <main class="container">
      <header>
  <h1 class="post-title">Haskell on the JVM via GHCJS and Nashorn</h1>
</header>
<div class="content">
  <div class="post-meta">
  <span class="post-date">27 Feb 2016</span>
  <span class="post-categories">
    
      &bull;

      
      
      

      
        Haskell
      
    
      &bull;

      
      
      

      
        <a href="/category/jvm/">
          JVM
        </a>
      
    
      &bull;

      
      
      

      
        Nashorn
      
    
      &bull;

      
      
      

      
        GHCJS
      
    
  </span>
</div>


  <div class="post-body">
    <p>Currently there are 2 ways we can write Haskell on the JVM:</p>

<ol>
  <li><a href="https://github.com/Frege/frege">Frege</a>, a language that follows Haskell 2010 standard and compiles to Java.</li>
  <li>Haskell itself by compiling it to JavaScript via GHCJS.</li>
</ol>

<p>Frege is basically a Haskell for the JVM and infact conforms to Haskell 2010 with few inbuilt GHC extensions. Even with good Java interop, it doesn’t sacrifice its type guarantees and currently is the only pure language on the JVM.</p>

<p>In this post, I am going to explore another interesting option: Haskell itself on the JVM. Haskell can be compiled to JavaScript using GHCJS and Java has an inbuilt JavaScript engine, called Nashorn so it is actually possible to compile Haskell to JavaScript and run the resulting JavaScript on the JVM.</p>

<p>Here is a simple Haskell code that can be run on the JVM:</p>
<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="c1">-- Nashorn doesn't provide default console object. Haskell's putStrLn logs to the console.</span>
<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"console={ </span><span class="se">\
    \</span><span class="s"> log: function(s) { java.lang.System.out.print(s); },</span><span class="se">\
    \</span><span class="s"> info: function(s) { java.lang.System.out.print(s); },</span><span class="se">\
    \</span><span class="s"> warn: function(s) { java.lang.System.out.print(s); },</span><span class="se">\
    \</span><span class="s"> debug: function(s) { java.lang.System.out.print(s); },</span><span class="se">\
    \</span><span class="s"> error: function(s) { java.lang.System.err.print(s); }</span><span class="se">\
    \</span><span class="s"> }"</span>
  <span class="n">setupConsole</span> <span class="o">::</span> <span class="kt">IO</span> <span class="nb">()</span>

<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"java.lang.System.exit($1)"</span>
  <span class="n">sysexit</span> <span class="o">::</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>

<span class="n">main</span> <span class="o">=</span> <span class="kr">do</span>
  <span class="n">setupConsole</span>
  <span class="n">putStrLn</span> <span class="s">"Hello from Haskell!"</span>
  <span class="n">sysexit</span> <span class="mi">0</span>

</code></pre></div></div>

<p>Nashorn doesn’t have an inbuilt <code class="language-plaintext highlighter-rouge">console</code> object and Haskell’s <code class="language-plaintext highlighter-rouge">putStrLn</code> prints to the console so we have to provide an implementation of console. The implementation, as can be seen from the code above, is actually backed by Java’s <code class="language-plaintext highlighter-rouge">System.out.print</code>. That is our first example of calling Java from Haskell. <code class="language-plaintext highlighter-rouge">sysexit</code> is another function calling Java. <code class="language-plaintext highlighter-rouge">sysexit</code> is needed here as otherwise the program just keeps on running which I think is because of JavaScript event loop or something similar that prevents the JVM from shutting down.</p>

<h3 id="compiling-haskell-with-ghcjs-and-running-on-jvm">Compiling Haskell with GHCJS and running on JVM</h3>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ ghcjs -o HelloJava HelloJava.hs
[1 of 1] Compiling Main             ( HelloJava.hs, HelloJava.js_o )
Linking HelloJava.jsexe (Main)

$ jjs HelloJava.jsexe/all.js 
Hello from Haskell!
</code></pre></div></div>
<p><code class="language-plaintext highlighter-rouge">jjs</code> is a JVM laucher for JavaScript code similar to Node. It is also possible to run this as a regular Java program along with other Java classes without <code class="language-plaintext highlighter-rouge">jjs</code>. <code class="language-plaintext highlighter-rouge">jjs</code> is just a convenient way  to run just JavaScript code on the JVM. Above GHCJS compiles the Haskell code to JavaScript in one file <code class="language-plaintext highlighter-rouge">all.js</code> and the JVM runs the JavaScript code from <code class="language-plaintext highlighter-rouge">all.js</code>.</p>

<h3 id="example-2">Example 2</h3>

<p>Now let’s look at another example that shows how to convert between Haskell and Java lists:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">{-# LANGUAGE ForeignFunctionInterface #-}</span>
<span class="cp">{-# LANGUAGE JavaScriptFFI #-}</span>
<span class="cp">{-# LANGUAGE UnliftedFFITypes #-}</span>
<span class="cp">{-# LANGUAGE GHCForeignImportPrim #-}</span>
<span class="cp">{-# LANGUAGE TypeSynonymInstances #-}</span>
<span class="cp">{-# LANGUAGE FlexibleInstances #-}</span>
<span class="cp">{-# LANGUAGE DataKinds #-}</span>
<span class="cp">{-# LANGUAGE PolyKinds #-}</span>
<span class="cp">{-# LANGUAGE DeriveDataTypeable #-}</span>
<span class="cp">{-# LANGUAGE TypeFamilies #-}</span>

<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Control.Monad.ST</span>
<span class="kr">import</span> <span class="nn">GHCJS.Types</span>
<span class="kr">import</span> <span class="nn">GHCJS.Foreign</span>
<span class="kr">import</span> <span class="nn">GHCJS.Prim</span>
<span class="kr">import</span> <span class="nn">Data.Typeable</span>
<span class="kr">import</span> <span class="nn">GHC.ST</span> 

<span class="kr">data</span> <span class="kt">MutabilityType</span> <span class="n">s</span> <span class="o">=</span> <span class="kt">Mutable</span>
                      <span class="o">|</span> <span class="kt">Immutable</span>
                      <span class="o">|</span> <span class="kt">STMutable</span> <span class="n">s</span>

<span class="kr">data</span> <span class="kt">IsItMutable</span> <span class="o">=</span> <span class="kt">IsImmutable</span>
                 <span class="o">|</span> <span class="kt">IsMutable</span>

<span class="c1">-- Copied from GHCJS.Internal.Types. Not sure why this is not exposed.</span>
<span class="kr">type</span> <span class="n">family</span> <span class="kt">Mutability</span> <span class="p">(</span><span class="n">a</span> <span class="o">::</span> <span class="kt">MutabilityType</span> <span class="n">s</span><span class="p">)</span> <span class="o">::</span> <span class="kt">IsItMutable</span> <span class="kr">where</span>
  <span class="kt">Mutability</span> <span class="kt">Immutable</span>     <span class="o">=</span> <span class="kt">IsImmutable</span>
  <span class="kt">Mutability</span> <span class="kt">Mutable</span>       <span class="o">=</span> <span class="kt">IsMutable</span>
  <span class="kt">Mutability</span> <span class="p">(</span><span class="kt">STMutable</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="kt">IsMutable</span>

<span class="cm">{- java.util.ArrayList class and its methods -}</span>
<span class="kr">newtype</span> <span class="kt">SomeArrayList</span> <span class="p">(</span><span class="n">a</span> <span class="o">::</span> <span class="kt">MutabilityType</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="kt">SomeArrayList</span> <span class="kt">JSVal</span> <span class="kr">deriving</span> <span class="kt">Typeable</span>
<span class="kr">type</span> <span class="kt">ArrayList</span>           <span class="o">=</span> <span class="kt">SomeArrayList</span> <span class="kt">Immutable</span>
<span class="kr">type</span> <span class="kt">MutableArrayList</span>    <span class="o">=</span> <span class="kt">SomeArrayList</span> <span class="kt">Mutable</span>
<span class="kr">type</span> <span class="kt">STArrayList</span> <span class="n">s</span>      <span class="o">=</span> <span class="kt">SomeArrayList</span> <span class="p">(</span><span class="kt">STMutable</span> <span class="n">s</span><span class="p">)</span>

<span class="kr">instance</span> <span class="kt">IsJSVal</span> <span class="p">(</span><span class="kt">SomeArrayList</span> <span class="n">m</span><span class="p">)</span>

<span class="c1">-- ArrayList Constructor</span>
<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"new $1()"</span>
  <span class="n">arrayList_new</span> <span class="o">::</span> <span class="kt">JType</span> <span class="o">-&gt;</span> <span class="kt">ST</span> <span class="n">s</span> <span class="p">(</span><span class="kt">STArrayList</span> <span class="n">s</span><span class="p">)</span> 

<span class="c1">-- Adds an element to ArrayList</span>
<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"$2.add($1)"</span>
  <span class="n">arrayList_add</span> <span class="o">::</span> <span class="kt">JSVal</span> <span class="o">-&gt;</span>  <span class="kt">STArrayList</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="kt">ST</span> <span class="n">s</span> <span class="nb">()</span>

<span class="cm">{- java.util.Iterator class and its methods -}</span>
<span class="kr">newtype</span> <span class="kt">SomeIterator</span> <span class="p">(</span><span class="n">a</span> <span class="o">::</span> <span class="kt">MutabilityType</span> <span class="n">s</span><span class="p">)</span> <span class="o">=</span> <span class="kt">SomeIterator</span> <span class="kt">JSVal</span> <span class="kr">deriving</span> <span class="kt">Typeable</span>
<span class="kr">type</span> <span class="kt">Iterator</span>            <span class="o">=</span> <span class="kt">SomeIterator</span> <span class="kt">Immutable</span>
<span class="kr">type</span> <span class="kt">MutableIterator</span>     <span class="o">=</span> <span class="kt">SomeIterator</span> <span class="kt">Mutable</span>
<span class="kr">type</span> <span class="kt">STIterator</span> <span class="n">s</span>        <span class="o">=</span> <span class="kt">SomeIterator</span> <span class="p">(</span><span class="kt">STMutable</span> <span class="n">s</span><span class="p">)</span>

<span class="kr">instance</span> <span class="kt">IsJSVal</span> <span class="p">(</span><span class="kt">SomeIterator</span> <span class="n">m</span><span class="p">)</span>

<span class="c1">-- Create an Iterator from an ArrayList</span>
<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"$1.iterator()"</span>
  <span class="n">iterator</span> <span class="o">::</span> <span class="kt">STArrayList</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="kt">ST</span> <span class="n">s</span> <span class="p">(</span><span class="kt">STIterator</span> <span class="n">s</span><span class="p">)</span>

<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"$1.hasNext()"</span>
  <span class="n">iterator_hasNext</span> <span class="o">::</span> <span class="kt">STIterator</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="kt">ST</span> <span class="n">s</span> <span class="kt">Bool</span>

<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"$1.next()"</span>
  <span class="n">iterator_next</span> <span class="o">::</span> <span class="kt">STIterator</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="kt">ST</span> <span class="n">s</span> <span class="kt">JSVal</span>

<span class="cm">{- Other Nashorn imports -}</span>

<span class="c1">-- Represents a Java type</span>
<span class="kr">newtype</span> <span class="kt">JType</span> <span class="o">=</span> <span class="kt">JType</span> <span class="kt">JSVal</span>

<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"java.lang.System.out.println($1)"</span>
  <span class="n">jprintln</span> <span class="o">::</span> <span class="kt">JSVal</span> <span class="o">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>

<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"java.lang.System.exit($1)"</span>
  <span class="n">sysexit</span> <span class="o">::</span> <span class="kt">Int</span> <span class="o">-&gt;</span> <span class="kt">IO</span> <span class="nb">()</span>

<span class="c1">-- Imports a Java class</span>
<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"Java.type($1)"</span>
  <span class="n">jimport</span> <span class="o">::</span> <span class="kt">JSVal</span> <span class="o">-&gt;</span> <span class="kt">JType</span> 

<span class="cm">{- Create an instance of Java's ArrayList from Haskell's list -}</span>
<span class="n">listToArrayList</span> <span class="o">::</span> <span class="p">[</span><span class="kt">JSVal</span><span class="p">]</span> <span class="o">-&gt;</span> <span class="kt">ST</span> <span class="n">s</span> <span class="p">(</span><span class="kt">STArrayList</span> <span class="n">s</span><span class="p">)</span>
<span class="n">listToArrayList</span> <span class="n">xs</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="kr">let</span> <span class="n">arrayListClass</span> <span class="o">=</span> <span class="n">jimport</span> <span class="o">$</span> <span class="n">toJSString</span> <span class="s">"java.util.ArrayList"</span>
    <span class="n">arrList</span> <span class="o">&lt;-</span> <span class="n">arrayList_new</span> <span class="n">arrayListClass</span>
    <span class="n">go</span> <span class="n">xs</span> <span class="n">arrList</span>
  <span class="kr">where</span>
    <span class="n">go</span> <span class="kt">[]</span> <span class="n">arrList</span> <span class="o">=</span> <span class="n">return</span> <span class="n">arrList</span>
    <span class="n">go</span> <span class="p">(</span><span class="n">x</span><span class="o">:</span><span class="n">xs</span><span class="p">)</span> <span class="n">arrList</span> <span class="o">=</span> <span class="kr">do</span>
      <span class="n">arrayList_add</span> <span class="n">x</span> <span class="n">arrList</span>
      <span class="n">go</span> <span class="n">xs</span> <span class="n">arrList</span>

<span class="cm">{- Create Haskell's list from Java's Iterator -}</span>
<span class="n">iteratorToList</span> <span class="o">::</span> <span class="kt">STIterator</span> <span class="n">s</span> <span class="o">-&gt;</span> <span class="kt">ST</span> <span class="n">s</span> <span class="p">[</span><span class="kt">JSVal</span><span class="p">]</span>
<span class="n">iteratorToList</span> <span class="n">itr</span> <span class="o">=</span> <span class="n">reverse</span> <span class="o">&lt;$&gt;</span> <span class="n">go</span> <span class="kt">[]</span> <span class="kr">where</span>
  <span class="n">go</span> <span class="n">acc</span> <span class="o">=</span> <span class="kr">do</span>
    <span class="n">hasNext</span> <span class="o">&lt;-</span> <span class="n">iterator_hasNext</span> <span class="n">itr</span>
    <span class="kr">if</span> <span class="n">hasNext</span>
      <span class="kr">then</span> <span class="kr">do</span>
        <span class="n">next</span> <span class="o">&lt;-</span> <span class="n">iterator_next</span> <span class="n">itr</span>
        <span class="n">go</span> <span class="p">(</span><span class="n">next</span><span class="o">:</span> <span class="n">acc</span><span class="p">)</span>
      <span class="kr">else</span>
        <span class="n">return</span> <span class="n">acc</span>

<span class="c1">-- Nashorn doesn't provide default console object. Haskell's putStrLn logs to the console.</span>
<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"console={ </span><span class="se">\
    \</span><span class="s"> log: function(s) { java.lang.System.out.print(s); },</span><span class="se">\
    \</span><span class="s"> info: function(s) { java.lang.System.out.print(s); },</span><span class="se">\
    \</span><span class="s"> warn: function(s) { java.lang.System.out.print(s); },</span><span class="se">\
    \</span><span class="s"> debug: function(s) { java.lang.System.out.print(s); },</span><span class="se">\
    \</span><span class="s"> error: function(s) { java.lang.System.err.print(s); }</span><span class="se">\
    \</span><span class="s"> }"</span>
  <span class="n">setupConsole</span> <span class="o">::</span> <span class="kt">IO</span> <span class="nb">()</span>

<span class="n">demo</span> <span class="o">=</span> <span class="n">runST</span> <span class="o">$</span> <span class="kr">do</span>
  <span class="n">jlist</span> <span class="o">&lt;-</span> <span class="n">listToArrayList</span> <span class="o">.</span> <span class="n">map</span> <span class="n">toJSInt</span> <span class="o">$</span> <span class="p">[</span><span class="mi">1</span><span class="o">..</span><span class="mi">5</span><span class="p">]</span>
  <span class="n">iterator</span> <span class="n">jlist</span> <span class="o">&gt;&gt;=</span> <span class="n">iteratorToList</span>
 
<span class="n">main</span> <span class="o">=</span> <span class="kr">do</span>
  <span class="n">setupConsole</span>
  <span class="n">mapM_</span> <span class="p">(</span><span class="n">putStrLn</span> <span class="o">.</span> <span class="n">show</span> <span class="o">.</span> <span class="n">fromJSInt</span><span class="p">)</span> <span class="n">demo</span>
  <span class="n">sysexit</span> <span class="mi">0</span>
 
</code></pre></div></div>

<p>In the code above, two Java types are used: <code class="language-plaintext highlighter-rouge">java.util.ArrayList</code> and <code class="language-plaintext highlighter-rouge">java.util.Iterator</code>.</p>

<h4 id="importing-a-java-class">Importing a Java class</h4>
<p>A Java class can be imported with <code class="language-plaintext highlighter-rouge">Java.type(className)</code> Nashorn JavaScript code. Line 80 defines the corresponding Haskell FFI function:</p>

<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Imports a Java class</span>
<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"Java.type($1)"</span>
  <span class="n">jimport</span> <span class="o">::</span> <span class="kt">JSVal</span> <span class="o">-&gt;</span> <span class="kt">JType</span>
</code></pre></div></div>
<h4 id="creating-an-instance-of-a-java-class">Creating an instance of a Java class</h4>
<p>An instance can be created by invoking the constructor on the Java class with <code class="language-plaintext highlighter-rouge">new</code>. Here is the corresponding FFI:</p>
<div class="language-haskell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- ArrayList Constructor</span>
<span class="n">foreign</span> <span class="kr">import</span> <span class="nn">javascript</span> <span class="n">unsafe</span> <span class="s">"new $1()"</span>
  <span class="n">arrayList_new</span> <span class="o">::</span> <span class="kt">JType</span> <span class="o">-&gt;</span> <span class="kt">ST</span> <span class="n">s</span> <span class="p">(</span><span class="kt">STArrayList</span> <span class="n">s</span><span class="p">)</span>
</code></pre></div></div>
<p>It takes the <code class="language-plaintext highlighter-rouge">ArrayList</code> class and invokes the dafault <code class="language-plaintext highlighter-rouge">ArrayList</code> constructor to return an instance of it. In the same way, we can create FFI functions for <code class="language-plaintext highlighter-rouge">ArrayList.add</code> and <code class="language-plaintext highlighter-rouge">ArrayList.iterator</code> to return an Java <code class="language-plaintext highlighter-rouge">Iterator</code> instance.</p>

<p>The function <code class="language-plaintext highlighter-rouge">listToArrayList</code> takes a Haskell list and return an instance of Java <code class="language-plaintext highlighter-rouge">ArrayList</code>. As the java list is mutable, it is returned as <code class="language-plaintext highlighter-rouge">STArrayList s</code> inside <code class="language-plaintext highlighter-rouge">ST</code>. This function first creates an instance of <code class="language-plaintext highlighter-rouge">ArrayList</code> by invoking the Java constructor and then calls <code class="language-plaintext highlighter-rouge">ArrayList.add</code> to add items from Haskell list to the <code class="language-plaintext highlighter-rouge">ArrayList</code>.</p>

<p>In the similar way, the function <code class="language-plaintext highlighter-rouge">iteratorToList</code> takes a Java <code class="language-plaintext highlighter-rouge">iterator</code> and returns Haskell list by extracting items from the iterator by invoking corresponding FFI functions for <code class="language-plaintext highlighter-rouge">Iterator.hasNext</code> and <code class="language-plaintext highlighter-rouge">Iterator.next</code>.</p>

<h3 id="building-with-stack">Building with <code class="language-plaintext highlighter-rouge">Stack</code></h3>
<p>It is easy to <a href="http://docs.haskellstack.org/en/stable/ghcjs/">setup a GHCJS project with <code class="language-plaintext highlighter-rouge">Stack</code></a> so that we can add other dependencies easily and build it for GHCJS. With the above code in a stack project “haskell-jvm-hello”, we can build it with <code class="language-plaintext highlighter-rouge">stack build</code> and run it with <code class="language-plaintext highlighter-rouge">jjs</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ stack build
haskell-jvm-hello-0.1.0.0: unregistering (local file changes: app/Main.hs)
haskell-jvm-hello-0.1.0.0: build
Preprocessing library haskell-jvm-hello-0.1.0.0...
In-place registering haskell-jvm-hello-0.1.0.0...
Preprocessing executable 'haskell-jvm-hello-exe' for
haskell-jvm-hello-0.1.0.0...
[1 of 1] Compiling Main             ( app/Main.hs, .stack-work/dist/x86_64-linux/Cabal-1.22.4.0_ghcjs/build/haskell-jvm-hello-exe/haskell-jvm-hello-exe-tmp/Main.js_o )
Linking .stack-work/dist/x86_64-linux/Cabal-1.22.4.0_ghcjs/build/haskell-jvm-hello-exe/haskell-jvm-hello-exe.jsexe (Main)
haskell-jvm-hello-0.1.0.0: copy/register
Installing library in
/workspace/haskell-jvm-hello/.stack-work/install/x86_64-linux/lts-3.12/ghcjs-0.2.0_ghc-7.10.3/lib/x86_64-linux-ghcjs-0.2.0-ghc7_10_3/haskell-jvm-hello-0.1.0.0-7MA0h74rERuEwiJY2TRuHx
Installing executable(s) in
/workspace/haskell-jvm-hello/.stack-work/install/x86_64-linux/lts-3.12/ghcjs-0.2.0_ghc-7.10.3/bin
Warning: the following files would be used as linker inputs, but linking is not being done: .stack-work/dist/x86_64-linux/Cabal-1.22.4.0_ghcjs/build/haskell-jvm-hello-exe/haskell-jvm-hello-exe
Registering haskell-jvm-hello-0.1.0.0...

$ jjs .stack-work/dist/x86_64-linux/Cabal-1.22.4.0_ghcjs/build/haskell-jvm-hello-exe/haskell-jvm-hello-exe.jsexe/all.js
1
2
3
4
5
</code></pre></div></div>

<p>Java’s Nashorn JavaScript engine opens up few more ways for the JVM to be polyglot and it is so good to have one of the best languages, Haskell, on the JVM. Actually it should also be possible to run PureScript as well in this way on the JVM but that is for another day. Happy Haskelling!</p>

    



<div class="post-tags">
  
    
    <a href="/tags/#haskell">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">Haskell</span>
    </a>
  
    
    <a href="/tags/#jvm">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">JVM</span>
    </a>
  
    
    <a href="/tags/#nashorn">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">Nashorn</span>
    </a>
  
    
    <a href="/tags/#ghcjs">
    
      <span class="icon">
        <svg fill="#000000" height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
    <path d="M0 0h24v24H0z" fill="none"/>
    <path d="M17.63 5.84C17.27 5.33 16.67 5 16 5L5 5.01C3.9 5.01 3 5.9 3 7v10c0 1.1.9 1.99 2 1.99L16 19c.67 0 1.27-.33 1.63-.84L22 12l-4.37-6.16z"/>
</svg>
      </span>&nbsp;<span class="tag-name">GHCJS</span>
    </a>
  
</div>
  </div>

  
  <section class="comments">
    <h2>Comments</h2>
    
  <div id="disqus_thread">
    <button class="disqus-load" onClick="loadDisqusComments()">
      Load Comments
    </button>
  </div>
  <script>

  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW
  *  TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT:s
  *  https://disqus.com/admin/universalcode/#configuration-variables
  */
  var disqus_config = function () {
    this.page.url = "http://localhost:4000/blog/2016/02/27/haskell-on-the-jvm-via-ghcjs-and-nashorn/";
    this.page.identifier = "" ||
                           "http://localhost:4000/blog/2016/02/27/haskell-on-the-jvm-via-ghcjs-and-nashorn/";
  }
  function loadDisqusComments() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = '//mmhelloworld.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  }
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="https://disqus.com/?ref_noscript">comments powered by Disqus</a>.
  </noscript>



  </section>

  <section class="related">
  <h2>Related Posts</h2>
  <ul class="posts-list">
    
      <li>
        <h3>
          <a href="/blog/2024/07/15/idris-jvm-0-7-0-release/">
            Idris JVM 0.7.0 Release
            <small>15 Jul 2024</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2021/07/24/idris-2-initial-release-0-dot-2-1-for-the-jvm/">
            Idris 2 Initial Release 0.2.1 for the JVM
            <small>24 Jul 2021</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="/blog/2020/12/30/idris-2-bootstrap-compiler-on-the-jvm-with-a-jvm-backend/">
            Idris 2 Bootstrap Compiler on the JVM with a JVM backend
            <small>30 Dec 2020</small>
          </a>
        </h3>
      </li>
    
  </ul>
</section>

</div>

    </main>

    <!-- Optional footer content -->

  </body>
</html>
